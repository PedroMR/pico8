pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- shmup


function init_game()
	actors={}
	pl_bul={}
	cam={x=0,y=0}
	pl={x=56,y=100,s=2,next_shot=0}
end


init_game()
-->8
--update

lvl={spawn={
 {e=1,x=20,y=-20},
 {e=1,x=20,y=-30}
}}
function _update()
 cam.y-=1
 camera(cam.x, cam.y)
 upd_input()
 upd_spawn()
end

function upd_spawn()
 for i,v in pairs(lvl.spawn) do
 	if v.y <= cam.y then
 	 spawn(v)
 	end
 end
 for i,v in pairs(lvl.spawn) do
 	if v.y <= cam.y then
 	 deli(lvl.spawn,i)
 	end
 end
end

function spawn(s)
 a={e=s.e,x=s.x,y=s.y}
 if(s.e==1) a.s=7
 add(actors,a)
end

function upd_input()
 local dx,dy=0,-1
 if (btn(1)) dx= 2 
 if (btn(0)) dx=-2
 if (btn(3)) dy+= 2 
 if (btn(2)) dy+=-2
 
 pl.x += dx
 if (pl.x < 0 or pl.x > 120) then
  pl.x -= dx
 end
 
 pl.y += dy
 if (pl.y-cam.y < 0 or pl.y-cam.y > 120) then
  pl.y -= dy+1
 end
 
 if dx==0 then pl.s = 2
 else pl.s = 2+sgn(dx)
 end

	pl.next_shot-=1;
 
 if btn(5) and pl.next_shot <= 0 then
   pl.next_shot=4
   add(pl_bul, {s=4,x=pl.x-4,y=pl.y+3,vy=-3})
   add(pl_bul, {s=4,x=pl.x+4,y=pl.y+3,vy=-3})
 end

 for i,b in pairs(pl_bul) do
 	b.y += b.vy
 end
 for i,b in pairs(pl_bul) do
  if (b.y<cam.y) deli(pl_bul,i)
 end

end


-->8
-- draw

function _draw()
 cls()
 --enemies
 for i,a in pairs(actors) do
  spr(a.s,a.x,a.y)
 end
 -- player
	spr(pl.s,pl.x,pl.y)
 local flame=18
 if(flr((40*t()))%2==0) flame=17
	spr(flame,pl.x,pl.y+8)
	-- player bullets
 for i,b in pairs(pl_bul) do
 	spr(b.s,b.x,b.y)
 end
 --enemy bullets
end
__gfx__
00000000000660000007700000066000000000000000000000000000044444400000000000000000000000000000000000000000000000000000000000000000
00000000000660000007700000066000000000000000000000000000400440040000000000000000000000000000000000000000000000000000000000000000
00700700000660000007700000066000000000000000000000000000400440040000000000000000000000000000000000000000000000000000000000000000
00077000005667000067760000766500000bb0000000000000000000080990800008800000000000000000000000000000000000000000000000000000000000
00077000005667000067760000766500000bb0000000000000000000000440000008800000000000000000000000000000000000000000000000000000000000
00700700b053370bb063360bb073350b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000505667075067760570766505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555667775567765577766555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000199100001aa10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001881000019910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000018810000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
